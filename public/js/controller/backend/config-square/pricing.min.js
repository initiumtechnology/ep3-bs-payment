(function () {
  $(document).ready(function () {
    $("#pricing-table").on("click", ".pricing-date-range-new", function (f) {
      f.preventDefault();
      var e = $("#pricing-table-template").html();
      $(this)
        .closest("table")
        .find("tr:last")
        .before("<tr><td>" + e + "</td></tr>");
      $(this)
        .closest("table")
        .find("tr:last")
        .siblings("tr:last")
        .hide()
        .fadeIn();
      $(".datepicker").datepicker();
    });
    $("#pricing-table").on("click", ".pricing-day-range-new", function (f) {
      f.preventDefault();
      var e = $("#pricing-table-template")
        .find(".pricing-day-range")
        .closest("table")
        .closest("td")
        .html();
      $(this)
        .closest("table")
        .find("tr:last")
        .before("<tr><td>" + e + "</td></tr>");
      $(this)
        .closest("table")
        .find("tr:last")
        .siblings("tr:last")
        .hide()
        .fadeIn();
    });
    $("#pricing-table").on("click", ".pricing-time-range-new", function (f) {
      f.preventDefault();
      var e = $("#pricing-table-template")
        .find(".pricing-time-range")
        .closest("tr")
        .closest("td")
        .html();
      $(this)
        .closest("table")
        .find("tr:last")
        .before("<tr><td>" + e + "</td></tr>");
      $(this)
        .closest("table")
        .find("tr:last")
        .siblings("tr:last")
        .hide()
        .fadeIn();
    });
    $("#pricing-table").on("click", ".pricing-price-new", function (f) {
      f.preventDefault();
      var e = $("#pricing-table-template")
        .find(".pricing-price")
        .closest("tr")
        .html();
      $(this)
        .closest("table")
        .find("tr:last")
        .before("<tr>" + e + "</tr>");
      $(this)
        .closest("table")
        .find("tr:last")
        .siblings("tr:last")
        .hide()
        .fadeIn();
      $(".tooltip").tooltip();
    });
    $("#pricing-table").on("click", ".pricing-delete", function (f) {
      f.preventDefault();
      var e = 200;
      if ($(this).closest("tbody").children("tr").length > 2) {
        $(this)
          .closest("tr")
          .fadeOut(e, function () {
            $(this).remove();
          });
      } else {
        if ($(this).parents("tbody:eq(2)").children("tr").length > 2) {
          $(this)
            .parents("tr:eq(2)")
            .fadeOut(e, function () {
              $(this).remove();
            });
        } else {
          if ($(this).parents("tbody:eq(4)").children("tr").length > 2) {
            $(this)
              .parents("tr:eq(4)")
              .fadeOut(e, function () {
                $(this).remove();
              });
          } else {
            $(this)
              .parents("tr:eq(6)")
              .fadeOut(e, function () {
                $(this).remove();
              });
          }
        }
      }
    });
    $("#pricing-save").on("click", function (f) {
      $("#pricing-form-rules input").remove();
      var e = 0;
      $("#pricing-table .pricing-price").each(function (m, h) {
        var r = $(h);
        var l = r.parents("tbody:eq(1)").find(".pricing-time-range");
        var u = l.parents("tbody:eq(2)").find(".pricing-day-range");
        var s = u.parents("tbody:eq(2)").find(".pricing-date-range");
        var n = s.find("input.datepicker:first").val();
        var y = s.find("input.datepicker:last").val();
        var o = u.find("select:first").val();
        var p = u.find("select:last").val();
        var z = l.find("input.timepicker:first").val();
        var j = l.find("input.timepicker:last").val();
        var t = r.find("input.pricepicker").val();
        var bf = r.find("input.booking_fee_picker").val();
        var q = r.find("select.pricing-rate-gross").val();
        var x = r.find("input.pricing-rate").val();
        var g = r.find("select.pricing-member").val();
        var v = m;
        var k = r.find("select.pricing-sid").val();
        var i = r.find("input.timeblockpicker").val();
        if (
          !n.match(/^(0[1-9]|[1-2][0-9]|3[0-1])\.(0[1-9]|1[0-2])\.[0-9]{4}$/)
        ) {
          window.alert(
            'Hinweis: Das Datum "' + n + '" ist ungültig - Format: 24.12.2014'
          );
          f.preventDefault();
          return;
        }
        if (
          !y.match(/^(0[1-9]|[1-2][0-9]|3[0-1])\.(0[1-9]|1[0-2])\.[0-9]{4}$/)
        ) {
          window.alert(
            'Hinweis: Das Datum "' + y + '" ist ungültig - Format: 24.12.2014'
          );
          f.preventDefault();
          return;
        }
        if (z.match(/^[0-9]{0,1}[0-9]$/)) {
          z += ":00";
        }
        if (!z.match(/^[0-9]{0,1}[0-9]:[0-9][0-9]$/)) {
          window.alert(
            'Hinweis: Die Uhrzeit "' + z + '" ist ungültig - Format: 23:15'
          );
          f.preventDefault();
          return;
        }
        if (j.match(/^[0-9]{0,1}[0-9]$/)) {
          j += ":00";
        }
        if (!j.match(/^[0-9]{0,1}[0-9]:[0-9][0-9]$/)) {
          window.alert(
            'Hinweis: Die Uhrzeit "' + j + '" ist ungültig - Format: 23:15'
          );
          f.preventDefault();
          return;
        }
        if (t.match(/^[0-9]+$/)) {
          t += ",00";
        }
        if (!t.match(/^[0-9]+,[0-9][0-9]$/)) {
          window.alert(
            'Hinweis: Der Preis "' + t + '" ist ungültig - Format: 19,95'
          );
          f.preventDefault();
          return;
        }
        if (bf.match(/^[0-9]+$/)) {
          bf += ",00";
        }
        if (!bf.match(/^[0-9]+,[0-9][0-9]$/)) {
          window.alert(
            'Hinweis: Der Preis "' + bf + '" ist ungültig - Format: 19,95'
          );
          f.preventDefault();
          return;
        }
        if (!i.match(/^[1-9][0-9]*$/)) {
          window.alert('Hinweis: Die Minutenangabe "' + i + '" ist ungültig');
          f.preventDefault();
          return;
        }
        var w = JSON.stringify([k, v, n, y, o, p, z, j, t, bf, x, q, i, g]);
        $("#pricing-form-rules").append(
          '<input type="hidden" name="pricing-rule-' +
            m +
            '" value="' +
            encodeURI(w) +
            '">'
        );
        e++;
      });
      $("#pricing-rules-count").val(e);
    });
    var d = window.pricingRules;
    var b;
    var a;
    var c;
    $.each(d, function (k, g) {
      console.log(g);
      var j = g[1];
      var l = g[3];
      var v = g[4];
      var o = g[5];
      var p = g[6];
      var w = g[7];
      var h = g[8];
      var s = g[9];
      var bs = g[10];
      var u = g[11];
      var q = g[12];
      var i = g[13];
      var n = g[14];
      var f = g[15];
      if (!j) {
        j = "null";
      }
      var e = "" + l + v;
      var r = "" + o + p;
      var m = "" + w + h;
      if (e !== b) {
        var t = $("#pricing-table-template").html();
        $("#pricing-table")
          .find("tr:last")
          .before("<tr><td>" + t + "</td></tr>");
      } else {
        if (r !== a) {
          var t = $("#pricing-table-template")
            .find(".pricing-day-range")
            .closest("table")
            .closest("td")
            .html();
          $("#pricing-table")
            .find(".pricing-day-range:last")
            .parents("tbody:eq(1)")
            .find("tr:last")
            .before("<tr><td>" + t + "</td></tr>");
        } else {
          if (m !== c) {
            var t = $("#pricing-table-template")
              .find(".pricing-time-range")
              .closest("table")
              .closest("td")
              .html();
            $("#pricing-table")
              .find(".pricing-time-range:last")
              .parents("tbody:eq(1)")
              .find("tr:last")
              .before("<tr><td>" + t + "</td></tr>");
          } else {
            var t = $("#pricing-table-template").find(".pricing-price").html();
            $("#pricing-table")
              .find(".pricing-price:last")
              .parents("tbody:eq(1)")
              .find("tr:last")
              .before('<tr><td class="pricing-price">' + t + "</td></tr>");
          }
        }
      }
      if (s >= 100) {
        s = s.substring(0, s.length - 2) + "," + s.substring(s.length - 2);
      } else {
        if (s >= 10) {
          s = "0," + s;
        } else {
          s = "0,0" + s;
        }
      }
      if (bs >= 100) {
        bs = bs.substring(0, bs.length - 2) + "," + bs.substring(bs.length - 2);
      } else {
        if (bs >= 10) {
          bs = "0," + bs;
        } else {
          bs = "0,0" + bs;
        }
      }
      $("#pricing-table .pricing-dateStart:last").val(l);
      $("#pricing-table .pricing-dateEnd:last").val(v);
      $("#pricing-table .pricing-dayStart:last").val(o);
      $("#pricing-table .pricing-dayEnd:last").val(p);
      $("#pricing-table .pricing-timeStart:last").val(w.substring(0, 5));
      $("#pricing-table .pricing-timeEnd:last").val(h.substring(0, 5));
      $("#pricing-table .pricing-price-number:last").val(s);
      $("#pricing-table .pricing-booking-fees-number:last").val(bs);
      $("#pricing-table .pricing-rate-gross:last").val(q);
      $("#pricing-table .pricing-rate:last").val(u);
      $("#pricing-table .pricing-sid:last").val(j);
      $("#pricing-table .pricing-timeBlock:last").val(Math.round(i / 60));
      $("#pricing-table .pricing-member:last").val(f);
      b = e;
      a = r;
      c = m;
    });
    $(".datepicker").datepicker();
  });
})();
